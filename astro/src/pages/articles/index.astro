---
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";

import MusicianLayout from "@/layouts/MusicianLayout.astro";

const articles = await getCollection("articles");

// Create a typed map: Record<string, CollectionEntry<"articles">[]>
const grouped: Record<string, CollectionEntry<"articles">[]> = {};

for (const article of articles) {
    const category = article.data.category;

    // Skip index files (those that don't have a slash in their slug)
    if (!article.slug.includes("/")) {
        continue;
    }

    if (!grouped[category]) {
        grouped[category] = [];
    }
    grouped[category].push(article);
}
---

<MusicianLayout title="Articles">
    <h1>Articles</h1>

    {
        Object.entries(grouped).map(([category, items]) => (
            <section>
                <h2>
                    <a href={`/articles/${category}`}>{category}</a>
                </h2>
                <ul>
                    {items.map((article) => (
                        <li>
                            <a href={`/articles/${article.slug}`}>
                                {article.data.title}
                            </a>
                            <p>{article.data.description}</p>
                        </li>
                    ))}
                </ul>
            </section>
        ))
    }
</MusicianLayout>
