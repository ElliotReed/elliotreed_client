---
import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";
import { Image } from "astro:assets";

import Breadcrumbs from "@/components/Breadcrumbs.astro";
import MainLayout from "@/layouts/MainLayout.astro";
import Heading from "@/components/Heading/Heading";
import CoverImage from "@/components/CoverImage.astro";
import ContentHeader from "@/layouts/ContentHeader.astro";
import MainLayoutGrid from "@/layouts/MainLayoutGrid.astro";

export async function getStaticPaths() {
    const allPosts = await getCollection("recording");

    // Only consider posts whose slug contains a "/" (i.e. has category and a non-index slug part)
    const filteredPosts = allPosts.filter(
        (entry: CollectionEntry<"recording">) => entry.slug.includes("/"),
    );

    return filteredPosts.map((entry: CollectionEntry<"recording">) => {
        const [category, slug] = entry.slug.split("/");

        return {
            params: { category, slug },
            props: { entry },
        };
    });
}

// Get the article from props
interface Props {
    entry: CollectionEntry<"recording">;
}

const { entry } = Astro.props as { entry: CollectionEntry<"recording"> };
const { Content } = await entry.render();

const { category, slug } = Astro.params;

const breadcrumbItems = [
    { label: "recording", href: "/recording" },
    { label: category, href: `/recording/${category}` },
    { label: slug, href: `/recording/${category}/${slug}` },
];
---

<MainLayout title={entry.data.title} description={entry.data.description}>
    <Breadcrumbs items={breadcrumbItems} />
    <MainLayoutGrid style="prefered-width">
        <CoverImage entry={entry} />

        <ContentHeader entry={entry} />

        <Content />
    </MainLayoutGrid>
</MainLayout>
