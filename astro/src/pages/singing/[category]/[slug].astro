---
import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";
import { Image } from "astro:assets";

import Breadcrumbs from "@/components/Breadcrumbs.astro";
import MusicianLayout from "@/layouts/MusicianLayout.astro";
import Heading from "@/components/Heading/Heading";
import MaxWidthContainer from "@/components/UI/MaxWidthContainer.astro";

export async function getStaticPaths() {
    const allPosts = await getCollection("singing");

    // Only consider posts whose slug contains a "/" (i.e. has category and a non-index slug part)
    const filteredPosts = allPosts.filter((entry: CollectionEntry<"singing">) =>
        entry.slug.includes("/"),
    );

    return filteredPosts.map((entry: CollectionEntry<"singing">) => {
        const [category, slug] = entry.slug.split("/");

        return {
            params: { category, slug },
            props: { entry },
        };
    });
}

// Get the article from props
interface Props {
    entry: CollectionEntry<"singing">;
}

const { entry } = Astro.props as { entry: CollectionEntry<"singing"> };
const { Content } = await entry.render();

const { category, slug } = Astro.params;

const breadcrumbItems = [
    { label: "singing", href: "/singing" },
    { label: category, href: `/singing/${category}` },
    { label: slug, href: `/singing/${category}/${slug}` },
];
---

<MusicianLayout
    title="Singing"
    description="A collection of singing-related articles and resources."
>
    <Breadcrumbs items={breadcrumbItems} />
    {
        entry.data.cover && (
            <Image
                class="cover"
                src={entry.data.cover}
                alt={entry.data.title}
                layout="full-width"
            />
        )
    }
    <Heading level={1}>{entry.data.title}</Heading>

    <p><em>{entry.data.publishedDate.toDateString()}</em></p>
    <Content />
</MusicianLayout>

<style lang="scss">
    @use "@/styles/abstracts" as *;

    .cover {
        width: 100%;
        height: 100%;
        object-fit: cover;
        aspect-ratio: 16 /9;
    }
</style>
